generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ SEGURIDAD ============

model Usuario {
  id            Int        @id @default(autoincrement())
  email         String     @unique
  claveHash     String     @map("clave_hash")
  nombre        String
  apellido      String
  ultimoAcceso  DateTime?  @map("ultimo_acceso")
  fechaCreacion DateTime   @default(now()) @map("fecha_creacion")
  fechaActualizacion DateTime @updatedAt @map("fecha_actualizacion")
  fechaEliminacion DateTime? @map("fecha_eliminacion")

  roles UsuarioRol[]

  @@map("usuarios")
}

model Rol {
  id             Int       @id @default(autoincrement())
  nombre         String    @unique
  descripcion    String?
  fechaCreacion  DateTime  @default(now()) @map("fecha_creacion")
  fechaEliminacion DateTime? @map("fecha_eliminacion")

  usuarios     UsuarioRol[]
  permisos     RolPermiso[]

  @@map("roles")
}

model Permiso {
  id          Int    @id @default(autoincrement())
  codigo      String @unique
  descripcion String?
  modulo      String

  roles RolPermiso[]

  @@map("permisos")
}

model UsuarioRol {
  id              Int      @id @default(autoincrement())
  usuarioId       Int      @map("usuario_id")
  rolId           Int      @map("rol_id")
  fechaAsignacion DateTime @default(now()) @map("fecha_asignacion")

  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  rol     Rol     @relation(fields: [rolId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, rolId])
  @@map("usuario_roles")
}

model RolPermiso {
  id         Int @id @default(autoincrement())
  rolId      Int @map("rol_id")
  permisoId  Int @map("permiso_id")

  rol     Rol     @relation(fields: [rolId], references: [id], onDelete: Cascade)
  permiso Permiso @relation(fields: [permisoId], references: [id], onDelete: Cascade)

  @@unique([rolId, permisoId])
  @@map("rol_permisos")
}

// ============ MAESTROS ============

model Cliente {
  id              Int       @id @default(autoincrement())
  razonSocial     String    @map("razon_social")
  cuit            String    @unique
  telefono        String?
  email           String?
  direccionFiscal String?   @map("direccion_fiscal")
  fechaCreacion   DateTime  @default(now()) @map("fecha_creacion")
  fechaActualizacion DateTime @updatedAt @map("fecha_actualizacion")
  fechaEliminacion DateTime? @map("fecha_eliminacion")

  sucursales Sucursal[]

  @@map("clientes")
}

model Zona {
  id             Int       @id @default(autoincrement())
  nombre         String    @unique
  descripcion    String?
  fechaCreacion  DateTime  @default(now()) @map("fecha_creacion")
  fechaEliminacion DateTime? @map("fecha_eliminacion")

  sucursales Sucursal[]
  vehiculos  Vehiculo[]

  @@map("zonas")
}

model Sucursal {
  id               Int       @id @default(autoincrement())
  clienteId        Int       @map("cliente_id")
  zonaId           Int       @map("zona_id")
  nombre           String
  direccion        String
  telefono         String?
  contactoNombre   String?   @map("contacto_nombre")
  contactoTelefono String?   @map("contacto_telefono")
  fechaCreacion    DateTime  @default(now()) @map("fecha_creacion")
  fechaActualizacion DateTime @updatedAt @map("fecha_actualizacion")
  fechaEliminacion DateTime? @map("fecha_eliminacion")

  cliente Cliente @relation(fields: [clienteId], references: [id])
  zona    Zona    @relation(fields: [zonaId], references: [id])

  @@map("sucursales")
}

model Vehiculo {
  id            Int       @id @default(autoincrement())
  zonaId        Int       @map("zona_id")
  patente       String    @unique
  marca         String?
  modelo        String?
  anio          Int?
  tipo          String?
  fechaCreacion DateTime  @default(now()) @map("fecha_creacion")
  fechaEliminacion DateTime? @map("fecha_eliminacion")

  zona Zona @relation(fields: [zonaId], references: [id])

  @@map("vehiculos")
}
